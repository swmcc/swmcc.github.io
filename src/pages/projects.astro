---
import BaseLayout from '../layouts/BaseLayout.astro';

const projects = [
  {
    name: 'swm.cc',
    url: 'https://swm.cc',
    github: 'https://github.com/swmcc/swmcc.github.io',
    articleUrl: '/projects/building-swm-cc',
    description: 'This site. Built with Astro 5 for zero-JavaScript-by-default architecture, Tailwind CSS 4 for modern utility-first styling, and MDX for type-safe content. Optimised for Core Web Vitals with static site generation and deployed via GitHub Pages.',
    tags: ['Astro 5', 'Tailwind CSS 4', 'MDX', 'TypeScript'],
    status: 'Active'
  },
  {
    name: 'whatisonthe.tv',
    url: 'https://www.whatisonthe.tv',
    github: 'https://github.com/swmcc/whatisonthe.tv',
    articleUrl: '/projects/building-whatisonthetv',
    description: 'TV and film tracking application. FastAPI backend with async PostgreSQL and SQLAlchemy, Redis for caching TheTVDB API responses, SvelteKit frontend with Tailwind CSS 3 for minimal JavaScript overhead. Built for performance and type safety end-to-end.',
    tags: ['FastAPI', 'PostgreSQL', 'Redis', 'SvelteKit', 'Tailwind CSS 3'],
    status: 'Active'
  },
  {
    name: 'second_breakfast',
    github: 'https://github.com/swmcc/second_breakfast',
    articleUrl: '/projects/building-second-breakfast',
    description: 'Recipe and meal tracking application. Rails 8 monolith with PostgreSQL, Hotwire, and Tailwind CSS. First project fully driven by AI workflows. Claude Code handles development, architecture, and CRUD operations. GitHub infrastructure manages code review, CI/CD, and deployments. An experiment in AI-native development practices and the boundaries of intelligent automation.',
    tags: ['Rails 8', 'PostgreSQL', 'Hotwire', 'Tailwind CSS 3', 'AI-Driven', 'Claude Code', 'GitHub Actions'],
    status: 'Active'
  },
  {
    name: 'Jotter',
    url: 'https://jotter.swm.cc',
    github: 'https://github.com/swmcc/jotter',
    articleUrl: '/projects/building-jotter',
    description: 'Self-hosted bookmark and image manager solving the problem of volatile third-party URLs. Ruby on Rails 8 with built-in authentication, polymorphic tagging across bookmarks and photos, Hotwire for progressive enhancement, Active Storage for file uploads, PostgreSQL for full-text search. Short URLs for easy sharing.',
    tags: ['Rails 8', 'Hotwire', 'Turbo', 'Stimulus', 'Tailwind CSS 4', 'PostgreSQL', 'Active Storage'],
    status: 'Active'
  },
  {
    name: 'the-mcculloughs.org',
    github: 'https://github.com/swmcc/the-mcculllughs.org',
    articleUrl: '/projects/the-mcculloughs-org',
    description: 'Archive of my family photos from the 1930s to present. Rails 8 monolith with Active Storage, polymorphic tagging, and mobile-first design. Migrating from Flickr to own the data and ensure longevity. Part of the "own your data" philosophy alongside Jotter and this site.',
    tags: ['Rails 8', 'Hotwire', 'Active Storage', 'Tailwind CSS 4', 'PostgreSQL', 'Mobile-First'],
    status: 'Active'
  },
  {
    name: 'tvdb-v4-python',
    github: 'https://github.com/thetvdb/tvdb-v4-python',
    articleUrl: '/projects/tvdb-v4-python',
    description: 'Official Python wrapper for TheTVDB API v4. Contributed throughout 2023 and 2024. Currently used in whatisonthe.tv for fetching series and movie metadata. Project appears dormant with the last commit in March 2024.',
    tags: ['Python', 'API Client', 'Open Source'],
    status: 'On Hold'
  },
  {
    name: 'tvdb_api',
    github: 'https://github.com/swmcc/tvdb_api',
    url: 'https://rubygems.org/gems/tvdb_api',
    articleUrl: '/projects/tvdb-api-ruby',
    description: 'Ruby gem for TheTVDB API. Created when planning to use Rails for whatisonthe.tv, but ultimately chose FastAPI for async I/O and performance. Stopped active development in 2023. Several other Ruby libraries exist for TheTVDB.',
    tags: ['Ruby', 'API Client', 'RubyGems'],
    status: 'Archived'
  },
  {
    name: 'TV-Listings',
    github: 'https://github.com/swmcc/TV-Listings',
    articleUrl: '/projects/tv-listings',
    description: 'Perl-based TV listings tracker from 2002-2007. Parsed XMLTV data, augmented with season and star info, watch lists, search, and daily emails. Built before streaming existed and Sky+ was new. Migrated to GitHub in 2013 but never modernised. Pure nostalgia.',
    tags: ['Perl', 'MySQL', 'XMLTV', 'Vintage'],
    status: 'Archived'
  }
];
---

<BaseLayout
  title="Projects - Stephen McCullough"
  description="Current projects and things I'm working on"
>
  <article class="prose prose-lg dark:prose-invert max-w-none space-y-12">
    <div class="space-y-6">
      <h1 style="color: var(--color-text-heading);">What I Am Working On</h1>

      <p style="color: var(--color-text); font-size: 1.125rem; line-height: 1.8;">
        These projects represent different architectural approaches to common problems. Static sites optimised for content delivery and Core Web Vitals. Async Python APIs with PostgreSQL and Redis, prioritising type safety and performance. Rails monoliths with Hotwire, choosing server-side rendering and proven technology over SPA complexity.
      </p>

      <p style="color: var(--color-text); font-size: 1.125rem; line-height: 1.8;">
        Each choice reflects deliberate trade-offs: static vs dynamic, async vs threaded, client-side vs server-side rendering. The technologies differ, but the principle is consistent - choose the simplest architecture that solves the problem, optimise for maintainability, and avoid unnecessary complexity.
      </p>

      <p style="color: var(--color-text); font-size: 1.125rem; line-height: 1.8;">
        I also contribute to open source projects when they align with my work. Some are actively maintained, others are dormant but still useful.
      </p>
    </div>

    <!-- Search and Filter -->
    <div class="not-prose">
      <div class="flex flex-col sm:flex-row gap-4 items-start">
        <!-- Search input -->
        <div class="flex-1 w-full">
          <label for="project-search" class="sr-only">Search projects</label>
          <input
            type="text"
            id="project-search"
            placeholder="ðŸ” Search projects..."
            class="w-full px-4 py-2 rounded-lg border transition-colors"
            style="background: var(--color-bg-secondary); color: var(--color-text); border-color: var(--color-border);"
          />
        </div>

        <!-- Filter dropdown button -->
        <div class="relative">
          <button
            id="filter-toggle"
            type="button"
            class="flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors whitespace-nowrap"
            style="background: var(--color-bg-secondary); color: var(--color-text); border-color: var(--color-border);"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
            </svg>
            <span>Filter by tag</span>
            <span id="filter-count" class="hidden px-2 py-0.5 rounded-full text-xs font-bold" style="background: var(--color-accent); color: white;"></span>
          </button>

          <!-- Dropdown panel -->
          <div
            id="filter-panel"
            class="hidden absolute right-0 mt-2 p-4 rounded-lg border shadow-lg z-10 min-w-[300px]"
            style="background: var(--color-bg); border-color: var(--color-border);"
          >
            <div class="flex items-center justify-between mb-3">
              <span class="text-sm font-medium" style="color: var(--color-text-heading);">Filter by Technology</span>
              <button
                id="clear-filters"
                class="text-xs px-2 py-1 rounded transition-opacity hover:opacity-70"
                style="color: var(--color-accent);"
              >
                Clear all
              </button>
            </div>
            <div class="flex flex-wrap gap-2" id="tag-filters">
              <!-- Tags will be populated by JavaScript -->
            </div>
          </div>
        </div>
      </div>

      <!-- Active filters display -->
      <div id="active-filters" class="flex flex-wrap gap-2 mt-4 empty:mt-0">
        <!-- Active filters will be shown here -->
      </div>
    </div>

    <div class="not-prose space-y-8" id="projects-list">
      {projects.map((project, index) => (
        <div
          class="card hover-lift-dramatic group relative overflow-hidden project-card"
          style={`animation-delay: ${index * 150}ms;`}
          data-name={project.name.toLowerCase()}
          data-description={project.description.toLowerCase()}
          data-tags={project.tags.join(',').toLowerCase()}
          data-status={project.status.toLowerCase()}
        >
          <!-- Status badge -->
          <div class="absolute top-4 right-4">
            <span
              style={
                project.status === 'Archived'
                  ? "background: #92400e; color: white;"
                  : project.status === 'On Hold'
                  ? "background: #6b7280; color: white;"
                  : "background: var(--color-accent); color: white;"
              }
              class="px-3 py-1 text-xs font-bold uppercase tracking-wider rounded-full shadow-lg"
            >
              {project.status}
            </span>
          </div>

          <div class="space-y-4">
            <!-- Project name with icon -->
            <div class="flex items-start gap-4">
              <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-purple-400/20 to-pink-400/20 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform duration-300">
                <svg class="w-8 h-8" style="color: var(--color-accent);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                </svg>
              </div>

              <div class="flex-1 min-w-0">
                <h2 style="color: var(--color-text-heading);" class="text-2xl font-bold mb-2">
                  {project.name}
                </h2>

                <div class="flex flex-wrap gap-3 mb-3">
                  {project.url && (
                    <a
                      href={project.url}
                      target="_blank"
                      rel="noopener noreferrer"
                      style="color: var(--color-accent);"
                      class="text-sm font-medium inline-flex items-center gap-1 hover:opacity-70 transition-opacity"
                    >
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path>
                      </svg>
                      Visit site
                    </a>
                  )}

                  {project.github && (
                    <a
                      href={project.github}
                      target="_blank"
                      rel="noopener noreferrer"
                      style="color: var(--color-accent);"
                      class="text-sm font-medium inline-flex items-center gap-1 hover:opacity-70 transition-opacity"
                    >
                      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                      </svg>
                      View source
                    </a>
                  )}

                  {project.articleUrl && (
                    <a
                      href={project.articleUrl}
                      style="color: var(--color-accent);"
                      class="text-sm font-medium inline-flex items-center gap-1 hover:opacity-70 transition-opacity"
                    >
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                      </svg>
                      Technical deep-dive
                    </a>
                  )}
                </div>
              </div>
            </div>

            <!-- Description -->
            <p style="color: var(--color-text);" class="text-base leading-relaxed">
              {project.description}
            </p>

            <!-- Tags -->
            {project.tags && project.tags.length > 0 && (
              <div class="flex flex-wrap gap-2 pt-2">
                {project.tags.map((tag) => (
                  <span
                    style="background: var(--color-bg-secondary); color: var(--color-accent); border: 1px solid var(--color-border);"
                    class="px-3 py-1 rounded-full text-xs font-medium cursor-pointer hover:opacity-70 transition-opacity tag-chip"
                    data-tag={tag.toLowerCase()}
                  >
                    {tag}
                  </span>
                ))}
              </div>
            )}
          </div>
        </div>
      ))}
    </div>

    <!-- No results message -->
    <div id="no-results" class="hidden text-center py-12">
      <p style="color: var(--color-text); font-size: 1.125rem;">
        No projects found matching your search.
      </p>
    </div>

    <div class="space-y-4 pt-8 border-t" style="border-color: var(--color-border);">
      <h2 style="color: var(--color-text-heading);">More Projects</h2>
      <p style="color: var(--color-text); font-size: 1.125rem; line-height: 1.8;">
        I'm working on other projects, but these are the ones I want documented and shared publicly. Most of my GitHub repositories are private by default - I prefer to be intentional about what I publish rather than treating GitHub as a performance space. Half-finished experiments, learning exercises, and abandoned ideas don't need an audience. When something is worth sharing, it'll end up here.
      </p>
    </div>
  </article>

  <style>
    article :global(h1),
    article :global(h2),
    article :global(h3),
    article :global(h4) {
      color: var(--color-text-heading);
      font-family: 'Space Grotesk', sans-serif;
      margin-top: 0;
    }

    article :global(p) {
      color: var(--color-text);
      margin-bottom: 1.5rem;
      line-height: 1.8;
    }

    article :global(a) {
      color: var(--color-accent);
    }

    article :global(a:hover) {
      color: var(--color-accent-hover);
    }

    .card {
      animation: slide-in-up 0.6s ease-out backwards;
    }

    @keyframes slide-in-up {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    #project-search:focus {
      outline: 2px solid var(--color-accent);
      outline-offset: 2px;
    }

    .tag-filter {
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .tag-filter:hover {
      opacity: 0.7;
    }

    .tag-filter.active {
      background: var(--color-accent) !important;
      color: white !important;
    }

    .project-card.hidden {
      display: none;
    }

    #filter-toggle:hover {
      opacity: 0.8;
    }

    #filter-panel {
      max-height: 400px;
      overflow-y: auto;
    }

    /* Smooth dropdown animation */
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    #filter-panel:not(.hidden) {
      animation: slideDown 0.2s ease-out;
    }
  </style>

  <script>
    // Get all unique tags from projects
    const projectCards = document.querySelectorAll('.project-card');
    const allTags = new Set();

    projectCards.forEach(card => {
      const tags = card.getAttribute('data-tags')?.split(',') || [];
      tags.forEach(tag => tag && allTags.add(tag.trim()));
    });

    // Populate tag filter buttons
    const tagFiltersContainer = document.getElementById('tag-filters');
    const sortedTags = Array.from(allTags).sort();

    sortedTags.forEach(tag => {
      const button = document.createElement('button');
      button.className = 'tag-filter px-3 py-1 rounded-full text-xs font-medium';
      button.style.cssText = 'background: var(--color-bg-secondary); color: var(--color-accent); border: 1px solid var(--color-border);';
      button.setAttribute('data-tag', tag);
      button.textContent = tag.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
      tagFiltersContainer.appendChild(button);
    });

    // State management
    let activeTagFilters = new Set();
    let searchQuery = '';

    // Filter function
    function filterProjects() {
      let visibleCount = 0;

      projectCards.forEach(card => {
        const name = card.getAttribute('data-name') || '';
        const description = card.getAttribute('data-description') || '';
        const tags = card.getAttribute('data-tags') || '';

        // Check text search
        const matchesSearch = !searchQuery ||
          name.includes(searchQuery) ||
          description.includes(searchQuery) ||
          tags.includes(searchQuery);

        // Check tag filters
        const matchesTags = activeTagFilters.size === 0 ||
          Array.from(activeTagFilters).every(filterTag =>
            tags.split(',').some(cardTag => cardTag.trim() === filterTag)
          );

        if (matchesSearch && matchesTags) {
          card.classList.remove('hidden');
          visibleCount++;
        } else {
          card.classList.add('hidden');
        }
      });

      // Show/hide no results message
      const noResults = document.getElementById('no-results');
      if (visibleCount === 0) {
        noResults.classList.remove('hidden');
      } else {
        noResults.classList.add('hidden');
      }

      // Update active filters display
      updateActiveFilters();
    }

    // Update active filters display
    function updateActiveFilters() {
      const activeFiltersContainer = document.getElementById('active-filters');
      const filterCount = document.getElementById('filter-count');
      activeFiltersContainer.innerHTML = '';

      // Update filter count badge
      if (activeTagFilters.size > 0) {
        filterCount.textContent = activeTagFilters.size;
        filterCount.classList.remove('hidden');
      } else {
        filterCount.classList.add('hidden');
      }

      if (activeTagFilters.size === 0 && !searchQuery) {
        return;
      }

      // Show active tag filters as removable chips
      activeTagFilters.forEach(tag => {
        const chip = document.createElement('button');
        chip.className = 'inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium transition-opacity hover:opacity-70';
        chip.style.cssText = 'background: var(--color-accent); color: white;';

        const tagText = document.createElement('span');
        tagText.textContent = tag.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');

        const removeIcon = document.createElement('span');
        removeIcon.innerHTML = 'Ã—';
        removeIcon.className = 'text-lg leading-none';

        chip.appendChild(tagText);
        chip.appendChild(removeIcon);

        chip.addEventListener('click', () => {
          activeTagFilters.delete(tag);
          const filterButton = document.querySelector(`.tag-filter[data-tag="${tag}"]`);
          if (filterButton) {
            filterButton.classList.remove('active');
          }
          filterProjects();
        });

        activeFiltersContainer.appendChild(chip);
      });
    }

    // Dropdown toggle functionality
    const filterToggle = document.getElementById('filter-toggle');
    const filterPanel = document.getElementById('filter-panel');

    filterToggle.addEventListener('click', () => {
      filterPanel.classList.toggle('hidden');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!filterToggle.contains(e.target) && !filterPanel.contains(e.target)) {
        filterPanel.classList.add('hidden');
      }
    });

    // Clear filters button in dropdown
    document.getElementById('clear-filters').addEventListener('click', () => {
      activeTagFilters.clear();
      searchQuery = '';
      document.getElementById('project-search').value = '';
      document.querySelectorAll('.tag-filter').forEach(btn => btn.classList.remove('active'));
      filterProjects();
    });

    // Search input handler
    const searchInput = document.getElementById('project-search');
    searchInput.addEventListener('input', (e) => {
      searchQuery = e.target.value.toLowerCase().trim();
      filterProjects();
    });

    // Tag filter click handlers
    document.querySelectorAll('.tag-filter').forEach(button => {
      button.addEventListener('click', () => {
        const tag = button.getAttribute('data-tag');

        if (activeTagFilters.has(tag)) {
          activeTagFilters.delete(tag);
          button.classList.remove('active');
        } else {
          activeTagFilters.add(tag);
          button.classList.add('active');
        }

        filterProjects();
      });
    });

    // Also make tags on cards clickable
    document.querySelectorAll('.tag-chip').forEach(chip => {
      chip.addEventListener('click', () => {
        const tag = chip.getAttribute('data-tag');
        const filterButton = document.querySelector(`.tag-filter[data-tag="${tag}"]`);

        if (filterButton) {
          if (activeTagFilters.has(tag)) {
            activeTagFilters.delete(tag);
            filterButton.classList.remove('active');
          } else {
            activeTagFilters.add(tag);
            filterButton.classList.add('active');
          }

          filterProjects();
        }
      });
    });
  </script>
</BaseLayout>
